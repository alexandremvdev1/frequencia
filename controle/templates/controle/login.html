{% load static %}
{% load controle_filters %}
<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>Login • Folha de Frequência</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap + FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Seu CSS global (se existir) -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">

  <style>
    :root{
      --ink:#0f172a; --muted:#64748b;
      --g1:#0b1020; --g2:#111a3a;
      --base-font:14px;
    }
    html{ font-size: var(--base-font); }
    body{
      min-height:100vh; margin:0; color:var(--ink);
      display:flex; align-items:center; justify-content:center;
      background:#f6f8fb;
      position:relative; overflow:hidden;
    }
    /* Fundo com imagem da escola (quando houver) + overlay suave */
    .auth-bg{
      position:fixed; inset:0;
      {% if escola and escola.logo %}
        background: url('{{ escola.logo.url }}') center/cover no-repeat fixed;
      {% else %}
        background: radial-gradient(1200px 600px at 10% 10%, #eef2ff, transparent),
                    linear-gradient(90deg, #f8fafc, #eef2f7);
      {% endif %}
      filter: {% if escola and escola.logo %} blur(2px) brightness(0.96){% else %}none{% endif %};
      transform: scale(1.02);
      z-index:0;
    }
    .auth-overlay{
      position:fixed; inset:0;
      background:linear-gradient(90deg, rgba(11,16,32,.55), rgba(17,26,58,.35));
      z-index:1;
      {% if not escola or not escola.logo %} display:none; {% endif %}
    }

    /* Card padrão do projeto */
    .card-clean{
      border:none; box-shadow:0 10px 24px rgba(17,24,39,.12); border-radius:.9rem;
      background:#fff; z-index:2;
    }
    .brand-badge{
      background:linear-gradient(90deg,var(--g1),var(--g2));
      color:#fff; border-radius:.6rem; padding:.6rem .8rem;
      display:flex; gap:.5rem; align-items:center; justify-content:center;
      font-weight:600; font-size:.95rem;
    }
    .text-muted-2{ color:var(--muted); }

    .login-wrap{ width:100%; max-width:420px; padding:1rem; }
    .logo-top{
      width:72px; height:72px; object-fit:contain; border-radius:.6rem; background:#fff; padding:.25rem;
      box-shadow:0 4px 10px rgba(17,24,39,.1);
    }
    .hr-soft{ border:0; border-top:1px solid #e5e7eb; margin:1rem 0; }
    .form-label{ font-weight:600; font-size:.9rem; }
    .btn-primary{ box-shadow:0 6px 16px rgba(59,130,246,.25); }
    .dev-banner{ font-size:.8rem; color:#fff; background:linear-gradient(90deg,#2a4d69,#3b82f6); border-radius:.6rem; }
  </style>
</head>
<body>
  <div class="auth-bg"></div>
  <div class="auth-overlay"></div>

  <main class="login-wrap">
    <div class="card card-clean p-3 p-md-4">
      <!-- Topo: logo + selo -->
      <div class="d-flex flex-column align-items-center text-center mb-3">
        {% if escola and escola.logo %}
          <img src="{{ escola.logo.url }}" alt="Logo" class="logo-top mb-2">
        {% endif %}
        <div class="brand-badge w-100">
          <i class="fa-solid fa-landmark-flag"></i>
          <span>Folha de Frequência</span>
        </div>
      </div>

      <h1 class="h6 text-center mb-2">
        <i class="fa-solid fa-right-to-bracket me-1"></i> Entrar no sistema
      </h1>
      {% if escola and escola.nome_escola %}
        <div class="text-center text-muted-2 small mb-2">{{ escola.nome_escola }}</div>
      {% endif %}

      <!-- Mensagens / erros -->
      {% if form.errors %}
        <div class="alert alert-danger py-2">Usuário ou senha inválidos.</div>
      {% endif %}
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags|default:'info' }} py-2 mb-2">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <form method="post" novalidate class="mt-2">
        {% csrf_token %}

        <div class="mb-2">
          <label for="{{ form.username.id_for_label }}" class="form-label">
            <i class="fa-solid fa-user me-1"></i> Usuário
          </label>
          {{ form.username }}
        </div>

        <div class="mb-2">
          <label for="{{ form.password.id_for_label }}" class="form-label">
            <i class="fa-solid fa-key me-1"></i> Senha
          </label>
          <div class="input-group">
            {{ form.password }}
            <button class="btn btn-outline-secondary" type="button" id="togglePass" aria-label="Mostrar/ocultar senha">
              <i class="fa-regular fa-eye"></i>
            </button>
          </div>
        </div>

        {% if next %}
          <input type="hidden" name="next" value="{{ next }}">
        {% endif %}

        <div class="d-grid mt-3">
          <button type="submit" class="btn btn-primary">
            <i class="fa-solid fa-arrow-right-to-bracket me-2"></i>Entrar
          </button>
        </div>
      </form>

      <hr class="hr-soft">

      <div class="text-center text-muted-2 small">
        Desenvolvido por Alexandre Martins Vieira © 2025
      </div>
    </div>
  </main>

  <script>
    // Aplicar classes Bootstrap aos widgets do Django
    (function applyBootstrapClasses(){
      const map = { 'INPUT':'form-control', 'SELECT':'form-select', 'TEXTAREA':'form-control' };
      document.querySelectorAll('input, select, textarea').forEach(el=>{
        const type = (el.getAttribute('type')||'').toLowerCase();
        if(type === 'checkbox'){ el.classList.add('form-check-input'); }
        else if(type === 'file'){ el.classList.add('form-control'); }
        else{ el.classList.add(map[el.tagName] || 'form-control'); }
        // placeholders amigáveis
        if(el.name === 'username' && !el.placeholder){ el.placeholder = 'Seu usuário'; }
        if(el.name === 'password' && !el.placeholder){ el.placeholder = 'Sua senha'; }
      });
      // Marca visualmente campos com erro
      if(document.querySelector('.alert-danger')){
        const u = document.getElementById('{{ form.username.id_for_label }}') || document.querySelector('[name="username"]');
        const p = document.getElementById('{{ form.password.id_for_label }}') || document.querySelector('[name="password"]');
        if(u) u.classList.add('is-invalid');
        if(p) p.classList.add('is-invalid');
      }
      // foco no usuário
      const first = document.getElementById('{{ form.username.id_for_label }}') || document.querySelector('[name="username"]');
      if(first) first.focus();
    })();

    // Mostrar/ocultar senha
    (function(){
      const btn = document.getElementById('togglePass');
      const input = document.getElementById('{{ form.password.id_for_label }}') || document.querySelector('[name="password"]');
      if(btn && input){
        btn.addEventListener('click', ()=>{
          const is = input.getAttribute('type') === 'password';
          input.setAttribute('type', is ? 'text' : 'password');
          btn.querySelector('i').className = is ? 'fa-regular fa-eye-slash' : 'fa-regular fa-eye';
        });
      }
    })();
  </script>
</body>
</html>
